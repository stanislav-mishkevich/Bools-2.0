# Новые возможности Bools 2.0

## Обзор изменений

В версии 2.0 добавлены следующие ключевые функции:

### 1. Начальный экран (StartScreenView)

При запуске приложения теперь отображается приветственный экран с двумя панелями:

**Левая панель - Информация о приложении:**
- Название и версия приложения
- Краткое описание функциональности
- Список основных возможностей с иконками
- Кнопки быстрого доступа:
  - "Создать новую схему" (синяя кнопка)
  - "Открыть схему..." (серая кнопка)

**Правая панель - Недавние схемы:**
- Список последних 10 открытых файлов
- Для каждого файла отображается:
  - Название файла
  - Дата последнего изменения
  - Путь к файлу
- Возможность открыть файл одним кликом
- Возможность удалить файл из списка (кнопка X при наведении)
- Кнопка "Очистить" для удаления всего списка

### 2. Управление несохраненными изменениями

Приложение теперь отслеживает состояние документа:

**Отслеживание изменений:**
- Автоматическая пометка `hasUnsavedChanges` при любом изменении схемы
- Флаг сбрасывается после успешного сохранения

**Диалог при закрытии:**
- При попытке закрыть окно с несохраненными изменениями появляется диалог
- Три варианта действий:
  1. **Сохранить** - сохраняет изменения и закрывает окно
  2. **Не сохранять** - закрывает окно без сохранения
  3. **Отменить** - отменяет закрытие окна

### 3. Улучшенное управление файлами

**RecentFilesManager:**
- Автоматическое отслеживание открытых файлов
- Хранение до 10 последних файлов
- Использование Security-Scoped Bookmarks для надежного доступа к файлам
- Сохранение списка между сеансами работы приложения

**WorkspaceViewModel:**
- Новое свойство `currentFileURL` - текущий открытый файл
- Новое свойство `hasUnsavedChanges` - флаг несохраненных изменений
- Метод `newDocument()` - создание нового документа с очисткой состояния
- Улучшенные методы `saveToURL()` и `loadFromURL()` с обновлением состояния

**Сохранение файлов:**
- Cmd+S сохраняет в текущий файл (или вызывает "Сохранить как...")
- Cmd+Shift+S всегда показывает диалог "Сохранить как..."
- Автоматическое добавление сохраненных файлов в список недавних

## Архитектура изменений

### Новые файлы:

1. **StartScreenView.swift**
   - Главный экран приложения
   - Компоненты: FeatureRow, RecentFileRow

2. **RecentFilesManager.swift**
   - ObservableObject для управления списком недавних файлов
   - Работа с UserDefaults и Security-Scoped Bookmarks

3. **CloseConfirmationModifier.swift**
   - View модификатор для macOS
   - Обработка события закрытия окна через NSWindowDelegate

### Измененные файлы:

1. **BoolsApp.swift**
   - Добавлен AppRootView для управления начальным экраном
   - Логика переключения между StartScreen и ContentView

2. **WorkspaceViewModel.swift**
   - Добавлены свойства для отслеживания документа
   - Обновлены методы сохранения/загрузки
   - Добавлен метод newDocument()

3. **ContentView.swift**
   - Изменена сигнатура для приема параметров извне
   - Обновлены методы работы с файлами
   - Добавлен метод saveWorkspaceAs()

## Использование

### Начало работы

1. Запустите приложение - откроется начальный экран
2. Выберите один из вариантов:
   - Создать новую схему
   - Открыть существующий файл
   - Выбрать файл из списка недавних

### Работа с файлами

1. **Создание нового документа**: File → New (Cmd+N)
2. **Открытие файла**: File → Open (Cmd+O)
3. **Сохранение**: File → Save (Cmd+S)
4. **Сохранить как**: File → Save As... (Cmd+Shift+S)

### Закрытие приложения

1. При наличии несохраненных изменений появится диалог
2. Выберите нужное действие
3. Окно закроется в соответствии с вашим выбором

## Технические детали

### Хранение недавних файлов

Список недавних файлов хранится в UserDefaults с ключом `"BoolsRecentFiles"`.
Используются Security-Scoped Bookmarks для безопасного доступа к файлам.

### Отслеживание изменений

Изменения отслеживаются через Combine Publishers на массивах `gates` и `wires`.
При любом изменении устанавливается флаг `hasUnsavedChanges = true`.

### Lifecycle окна

Используется NSWindowDelegate через NSViewRepresentable для перехвата события закрытия окна.

## Будущие улучшения

Возможные направления развития:

1. Автосохранение схем
2. Восстановление последнего сеанса
3. Превью схем в списке недавних файлов
4. Группировка файлов по проектам
5. Облачная синхронизация через iCloud
